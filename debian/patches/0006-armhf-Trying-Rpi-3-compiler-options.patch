From: Alec Leamas <leamas.alec@gmail.com>
Date: Sat, 6 Jul 2024 19:07:54 +0200
Subject: armhf:  Trying Rpi 3 compiler options

---
 CMakeLists.txt                | 5 +++++
 libs/mipmap/src/mipmap_neon.c | 3 +++
 2 files changed, 8 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f88cb01..ba75be0 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -452,6 +452,11 @@ if (QT_ANDROID)
   set(CMAKE_SHARED_LINKER_FLAGS "-Wl,-soname,libgorp.so -Wl,--build-id")
 endif ()
 
+if (ARCH STREQUAL armhf)
+  # See: https://forums.raspberrypi.com/viewtopic.php?t=144115
+  add_compile_options(-mcpu=cortex-a53  -mfpu=neon-fp-armv8)
+endif ()   # Assuming at least RPi 3
+
 message(STATUS "Final compiler options:")
 message(STATUS "CMAKE_CXX_FLAGS: ${CMAKE_CXX_FLAGS}")
 message(STATUS "CMAKE_CXX_FLAGS_DEBUG: ${CMAKE_CXX_FLAGS_DEBUG}")
diff --git a/libs/mipmap/src/mipmap_neon.c b/libs/mipmap/src/mipmap_neon.c
index da6d714..19ca5a4 100644
--- a/libs/mipmap/src/mipmap_neon.c
+++ b/libs/mipmap/src/mipmap_neon.c
@@ -30,6 +30,7 @@
 
 #if defined(__ARM_NEON) || defined(__ARM_NEON_FP)
 #include <arm_neon.h>
+#pragma message "Building ARM mipmap neon extentions"
 
 // about twice as fast as generic
 void MipMap_24_neon( int width, int height, unsigned char *source, unsigned char *target )
@@ -217,4 +218,6 @@ void MipMap_32_neon( int width, int height, unsigned char *source, unsigned char
         u += stride;
     }
 }
+#else
+#pragma message "Not building ARM mipmap neon extentions"
 #endif
