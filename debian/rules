#!/usr/bin/make -f

include  /usr/share/dpkg/architecture.mk

export DEB_BUILD_MAINT_OPTIONS = hardening=+all

ifneq  ($(filter circleci,$(DEB_BUILD_PROFILES)),)
    DISABLE_LOCALE_TESTS = ON
else
    DISABLE_LOCALE_TESTS = OFF
endif

%:
	dh $@

override_dh_auto_configure:
	dh_auto_configure -- \
            -DCMAKE_BUILD_TYPE=RelWithDebInfo \
            -DCMAKE_LIBRARY_PATH=$(DEB_HOST_MULTIARCH) \
            -DCMAKE_INSTALL_LIBDIR=/usr/lib \
            -DBUILD_SHARED_LIBS=OFF \
            -DOCPN_BUNDLE_DOCS=OFF \
            -DOCPN_BUNDLE_TCDATA=ON \
            -DOCPN_USE_BUNDLED_LIBS=OFF \
            -DOCPN_USE_NEWSERIAL=ON \
            -DOCPN_PLUGIN_CONTENTS_WARN=ON \
            -DOCPN_FORCE_GTK3=ON \
            -DOCPN_DISTRO_BUILD=ON \
            -DDISABLE_LOCALE_TESTS=$(DISABLE_LOCALE_TESTS) \
            -DCHARTDLDR_USE_UNARR=OFF

override_dh_auto_test:
	cd obj-*-linux-gnu*; make run-tests
